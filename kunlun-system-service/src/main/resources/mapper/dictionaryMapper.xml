<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kunlun.system.dao.IDictionaryDao" >

    <select id="getAllDictionary" parameterType="java.util.Map" resultType="DictionaryModel">
        SELECT
            id,
            dict_name AS dictName,
            dict_code AS dictCode,
            status,
            description,
            create_time AS createTime,
            modified_time AS modifiedTime
        FROM t_system_dictionary
        ORDER BY create_time DESC
        OFFSET #{currentPage} LIMIT #{pageSize}
    </select>

    <select id = "getDictionaryCount" parameterType="java.util.Map" resultType = "java.lang.Integer">
        SELECT
            COUNT(id)
        FROM t_system_dictionary
    </select>

    <select id = "getAllDictionarySub" parameterType="java.util.Map" resultType = "DictionarySubModel">
        SELECT
            id,
            dict_sub_name AS dictSubName,
            dict_sub_code AS dictSubCode,
            dict_value AS dictValue,
            description,
            dict_id AS dictId,
            create_time AS createTime
        FROM t_system_dictionary_sub
        WHERE dict_id = #{dictId}
    </select>

    <select id = "getDictionarySubCount" parameterType="java.util.Map" resultType = "java.lang.Integer">
        SELECT
            COUNT(id)
        FROM t_system_dictionary_sub
        WHERE dict_id = #{dictId}
    </select>

    <sql id="queryLogCondition">
        <if test="modelName != null and modelName != ''">
            AND name_ LIKE CONCAT('%', #{modelName}, '%')
        </if>
        <if test="modelKey != null and modelKey != ''">
            AND key_ LIKE CONCAT('%', #{modelKey}, '%')
        </if>
        <if test="createTime != null and createTime != ''">
            AND create_time_ = #{createTime}
        </if>
    </sql>

    <insert id="insertOperateLog" parameterType="OperatorLogModel">
        INSERT INTO t_operator_log
        (id, ip, user_name, operator_type, operate_description, request_url, protocal, params, clz_name, method_name,
        exception_info, style, service_name, port, thread_name, operate_time, status)
        VALUES (
          #{id}, #{ip}, #{userName}, #{operatorType}, #{operateDescription}, #{requestUrl}, #{protocal}, #{params}, #{clzName},
          #{methodName}, #{exceptionInfo}, #{style}, #{serviceName}, #{port}, #{threadName}, #{operateTime}, #{status}
        )
    </insert>

    <update id="updateOperateLog" parameterType="OperatorLogModel">
        UPDATE t_operator_log SET exception_info = #{exceptionInfo}, status = #{status} WHERE id = #{id}
    </update>

</mapper>
